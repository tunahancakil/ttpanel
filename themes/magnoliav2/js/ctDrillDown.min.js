(function(a){var b="ctDrillDown";var c={init:function(c){c=a.extend({},a.fn.ctDrillDown.defaults,c);return this.each(function(){var e=a(this).addClass(c.myClass);var g=a(">ul",e);e.data(b,{options:c,$menu:g,path:new Array,pathNumerical:new Array,offset:g.width(),keysActive:false});var h=new Array;l.apply(e,[g]);var i=e.width();e.css("width",i+"px");a("ul",g).css("width",i+"px").css("left",i+"px");if(c.keyboardNavigation){var j=false;a(document).bind("keyup",function(d){if(d.keyCode==77&&d.ctrlKey){var f=e.data(b);f.keysActive=!f.keysActive;if(f.keysActive){var g=e.data(b).path;var h;if(g.length){h=a(">li:eq(0)",g[g.length-1].nextAll("ul"))}else{h=a(">li:eq(0)",e.data(b).$menu)}h.addClass(c.activeClass)}}return true});a(document).bind("keyup",function(c){var d=e.data(b);if(!d.keysActive&&a(":focus",e).length==0){return true}switch(c.keyCode){case 8:case 13:case 37:case 38:case 39:case 40:o.apply(e,[c.keyCode]);break}return false})}if(c.ajax){a(document).on(c.event,"li."+c.expandableClass+" > a",function(){var b=a(this);if(!a(this).nextAll("ul").length){a.ajax({type:"GET",url:b.attr("href"),dataType:"html",success:function(a){b.after(a);n.apply(e,b.nextAll("ul"));e.ctDrillDown("goTo",b)}})}else{e.ctDrillDown("goTo",a(this))}return false})}else{a("a",g).each(function(){var b=false;if(a(this).nextAll("ul").length>0){a(this).parent().addClass(c.expandableClass);b=true}a(this).bind(c.event,function(){if(!b){return true}e.ctDrillDown("goTo",a(this));return false});if(a(this).hasClass(c.currentClass)){a(this).removeClass(c.currentClass);var f=a(this).closest("li."+c.expandableClass);var g=a(">a",f).addClass(c.currentClass);h=d.apply(e,[g])}});if(c.useCookies){var m=k(b);if(m!=null&&m!=""){var p=m.split(",");if(p.length>0){h=p}}}if(h.length>0){f.apply(e,[h,false]);e.dequeue(b)}}})},goTo:function(c,e){return this.each(function(){var g=a(this),i=g.data(b),j=i.pathNumerical,k=i.options;if(e==undefined){e=true}if(c==undefined||c==null){return}if(!i.$menu.has(c).length){g.ctDrillDown("goTop",e);return}if(!c.closest("li").hasClass(k.expandableClass)){g.ctDrillDown("goTo",c.closest("li."+k.expandableClass).find(">a"),e);return}var l=d.apply(g,[c]);var m=j.length;var n=new Array;for(var o=0;o<l.length;o++){if(m<o){n=l.slice(o,l.length);break}if(l[o]!=j[o]){var p=j.length-o;for(var q=0;q<p;q++){h.apply(g,[e])}n=l.slice(o,l.length);break}}if(l.length<j.length&&n.length==0){var p=j.length-l.length;for(var q=0;q<p;q++){h.apply(g,[e])}}f.apply(g,[n,e]);g.dequeue(b);return})},goTop:function(c){return this.each(function(){var d=a(this),e=d.data(b);if(c==undefined){c=true}d.ctDrillDown("goUp",e.path.length,c)})},goUp:function(c,d){if(d==undefined){d=true}return this.each(function(){if(c==0){return}var e=a(this);for(var f=0;f<c;f++){h.apply(e,[d])}e.dequeue(b);return})},option:function(c,d){if(typeof c==="string"){if(d===undefined){var e=a(this),f=e.data(b);return f.options[c]}else{var e=a(this),f=e.data(b);f.options[c]=d;e.data(b,f);return this}}},search:function(c,d,e){if(c==""){return new Array}if(d==undefined){d=true}if(e==undefined){e=false}var f=a(this),g=f.data(b),h=g.options,i=new RegExp(c,"i"),j=g.$menu;var k=new Array;var l=a("li > a",j);l.filter("."+h.matchClass).removeClass(h.matchClass);l.each(function(){if(a(this).text().match(i)){a(this).addClass(h.matchClass);k.push(a(this))}});if(d&&k.length==1){var m=a(k[0]).parents("li");var n;if(m.length<2){f.ctDrillDown("goTop",e)}else{f.ctDrillDown("goTo",a(">a",m[1]),e)}}return k},searchWrapper:function(b,c,d,e){return this.each(function(){var f=a(this);b.submit(function(){var g=a("input[type=text]",b).val();var h=f.ctDrillDown("search",g,d,e);c.html("");if(h.length>1){var i=a("<div></div>");a.each(h,function(a,b){var c=f.ctDrillDown("getBreadcrumbs",b);var d=f.ctDrillDown("getBreadcrumbsFormatted",c,e);i.append(d)});c.html(i)}return false})})},getBreadcrumbs:function(c){var d=a(this),e=d.data(b);return i.apply(d,[c])},getBreadcrumbsFormatted:function(b,c){var d=a(this);if(b==undefined){b=d.ctDrillDown("getBreadcrumbs")}if(c==undefined){c=true}var e=a('<div class="breadcrumbs"></div>');a.each(b,function(b,f){var g=a('<span class="breadcrumb">'+a(f).text()+"</span>").bind("click",function(){d.ctDrillDown("goTo",f,c);return false});e.append(g).append(" ")});return e}};var d=function(c){var d=a(this),e=d.data(b),f=e.options,g=new Array;c.parentsUntil("."+f.myClass,"li").each(function(){g.push(a(this).index())});g=g.reverse();return g};var e=function(c){var d=a(this),e=d.data(b),f=e.options,g=new Array;c.parentsUntil("."+f.myClass,"li").each(function(){g.push(a(">a",a(this)))});g=g.reverse();return g};var f=function(c,d){var e=a(this),h=e.data(b),i=h.$menu,j=h.pathNumerical,k=h.path,l=h.options;if(c.length==0){return}if(j.length==0){g.apply(e,[a(">li:eq("+c[0]+")>a",i),d])}else{var m=k[k.length-1];var n=m.nextAll("ul").find(">li:eq("+c[0]+")>a");g.apply(e,[n,d])}return f.apply(e,[c.slice(1,c.length),d])};var g=function(c,d){var e=a(this),f=e.data(b),g=f.options,h=f.path,i=f.pathNumerical;var k=c.closest("ul");var n=c.nextAll("ul");g.onBeforeOpen(c);var o=g.duration;if(!d){o=0}e.queue(b,function(a){n.show();if(g.heightAutoAdjust){l.apply(e,[n])}k.animate({left:"-="+f.offset},{duration:o,easing:g.easing,complete:function(){a()}})});h.push(c);i.push(c.closest("li").index());if(g.useCookies){j(b,i)}f.path=h;f.pathNumerical=i;e.data(b,f);g.onOpened(c);e.trigger("drilldownchange",[c,true]);if(g.ajaxPreloading){m.apply(e,[c])}return};var h=function(c){var d=a(this),e=d.data(b),f=e.$menu,g=e.options,h=e.path,i=e.pathNumerical;var k=h.pop();if(k==null){return}var m=k.closest("ul");var n=k.nextAll("ul");var o=g.duration;if(c==false){o=0}g.onBeforeClose(k);d.queue(b,function(a){m.show();m.animate({left:"+="+e.offset},{duration:o,easing:g.easing,complete:function(){n.hide();a()}});if(g.heightAutoAdjust){l.apply(d,[m])}});i.pop();if(g.useCookies){j(b,i)}e[i]=i;e[h]=h;d.data(b,e);var p=h[h.length-1];g.onClosed(k);d.trigger("drilldownchange",[p,false])};var i=function(c){var d=a(this),f=d.data(b),g=f.options;var h=new Array;h.push(a('<span class="">'+g.startName+"</span>"));var i=f.path;if(c!=undefined){i=e.apply(d,[c])}return h.concat(i)};var j=function(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+c*24*60*60*1e3);var e="; expires="+d.toGMTString()}else var e="";document.cookie=a+"="+b+e+"; path=/"};var k=function(a){var b=a+"=";var c=document.cookie.split(";");for(var d=0;d<c.length;d++){var e=c[d];while(e.charAt(0)==" ")e=e.substring(1,e.length);if(e.indexOf(b)==0)return e.substring(b.length,e.length)}return null};var l=function(c){var d=a(this),e=c.data(b),f;if(e!=undefined){f=e.height}else{f=c.height();e={height:f};c.data(b,e)}d.animate({height:f},{duration:200})};var m=function(c){var d=a(this),e=d.data(b),f=e.options;c.nextAll("ul").find("li."+f.expandableClass+">a").each(function(){var b=a(this);if(b.nextAll("ul").length>0){return}a.ajax({type:"GET",url:b.attr("href"),dataType:"html",success:function(a){b.after(a);n.apply(d,b.nextAll("ul"))}})})};var n=function(c){var d=a(this),e=d.data(b);a(c).css("width",e.$menu.width()+"px").css("left",e.$menu.width()+"px");e.$menu=a(">ul",d);d.data(b,e)};var o=function(c){var d=a(this),e=d.data(b),f=e.path,g=e.options,h=e.$menu;if(f.length>0){var i=f[f.length-1];h=i.nextAll("ul")}else{if(c==37){return}}var j=a("> li."+g.activeClass,h);if(c==37||c==8){d.ctDrillDown("goUp",1);j.removeClass(g.activeClass);h.parent().parent("ul").find(">li:eq(0)").addClass(g.activeClass);return}if(c==39||c==13){var k=a(">a",j);if(!j.hasClass(g.expandableClass)){if(c==13&&k.length){window.location=k.attr("href")}return}if(k.length){d.ctDrillDown("goTo",k);j.removeClass(g.activeClass);a(">li:eq(0)",k.nextAll("ul")).addClass(g.activeClass)}return}if(c==40){var l=j.next("li");if(j.length==0){l=a(">li:eq(0)",h)}}else if(c==38){var l=j.prev("li");if(j.length==0){l=a(">li:last",h)}}if(l.length>0){j.removeClass(g.activeClass);l.addClass(g.activeClass)}return};a.fn.ctDrillDown=function(b){if(c[b]){return c[b].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof b==="object"||!b){return c.init.apply(this,arguments)}else{a.error("Method "+b+" does not exist on Drill Down!")}};a.fn.ctDrillDown.defaults={myClass:"ctDrillDown",expandableClass:"expandable",onOpened:a.noop,onBeforeOpen:a.noop,onClosed:a.noop,onBeforeClose:a.noop,duration:300,easing:"linear",currentClass:"current",useCookies:false,heightAutoAdjust:true,matchClass:"match",startName:"",ajax:false,ajaxPreloading:true,event:"click",keyboardNavigation:true,activeClass:"active"}})(jQuery)